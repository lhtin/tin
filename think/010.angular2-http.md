# Angular2之HTTP模块

## 引子：使用原生JS上传文件

参考：[Using XMLHttpRequest(MDN)](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest)

在单页应用中，上传文件只能通过浏览器提供的AJAX。AJAX结合FormData对象上传文件最简单，demo如下：

```html
<form id="form">
  <label>请输入文件名称：</label>
  <input type="text" name="filename">
  <label>请选择文件：</label>
  <input type="file" name="file">
  <button id="btn">提交</button>
</form>
<script>
    var btn = document.getElementById('btn');
    var form = document.getElementById('form');
    btn.addEventListener('click', function (e) {
        var formData = new FormData(form);
        formData.append('extra', '而外信息');
        var xhr = new XMLHttpRequest();
        xhr.open('post', '/upload');
        xhr.addEventListener('load', function (event) {
            if (xhr.status === 200) {
                // success
            } else {
                // fail
            }
        });
        xhr.send(formData); // 注意不能设置Content-Type
        e.preventDefault();
    });
</script>
```

同时参考文章中提供了另外一种方式，这种方式需要使用AJAX和FileReader，相当于需要手动构造一个`Content-Type`为`multipart/form-data`格式的请求体（body）。由于FormData和FileReader支持的IE一致，所以完全没有必要使用这种复杂的方式。

## HTTP模块如何上传文件

从上面的例子可以得知，使用FormData来上传文件时，不能设置头部的`Content-Type`字段。如果设置了这个字段，相当于引子中的第二种方式，需要手动构造特定格式的请求体。

--未完--